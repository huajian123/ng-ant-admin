import{a as E}from"./chunk-V6VP5ZUC.js";import{d as l,e as h,f as I}from"./chunk-5BCZZY3T.js";import{a as D}from"./chunk-Q5VVKPDT.js";import{a as A}from"./chunk-F5ALC7SR.js";import{a as v}from"./chunk-YN3PI5LS.js";import{i as R,m as T}from"./chunk-6E3GIBKW.js";import{d as y}from"./chunk-NGTZY5Y2.js";import{Ua as S,i as g,qa as b,wa as i}from"./chunk-PHCOYEBV.js";import{g as C}from"./chunk-VB56BUGO.js";var P=C(E());var u=class u{constructor(){this._doc=i(y);this.platform=i(A)}_getDoc(){return this._doc||document}_getWin(){return this._getDoc().defaultView||window}getScrollPosition(t){if(!this.platform.isBrowser)return[0,0];let e=this._getWin();return t&&t!==e?[t.scrollLeft,t.scrollTop]:[e.pageXOffset,e.pageYOffset]}scrollToPosition(t,e){this.platform.isBrowser&&(t||this._getWin()).scrollTo(e[0],e[1])}scrollToElement(t,e=0){if(!this.platform.isBrowser)return;t||(t=this._getDoc().body),t.scrollIntoView();let r=this._getWin();r&&r.scrollBy&&(r.scrollBy(0,t.getBoundingClientRect().top-e),r.pageYOffset<20&&r.scrollBy(0,-r.pageYOffset))}scrollToTop(t=0){this.platform.isBrowser&&this.scrollToElement(this._getDoc().body,t)}};u.\u0275fac=function(e){return new(e||u)},u.\u0275prov=b({token:u,factory:u.\u0275fac,providedIn:"root"});var m=u;var o=class o{constructor(){this.destroyRef=i(S);this.doc=i(y);this.scrollService=i(m);this.isShowTab$=i(D).getThemesMode()}static deleteRouteSnapshot(t){o.handlers[t]&&(o.handlers[t].componentRef&&o.handlers[t].componentRef.destroy(),delete o.handlers[t],delete o.scrollHandlers[t])}static deleteAllRouteSnapshot(t){return new Promise(e=>{Object.keys(o.handlers).forEach(r=>{o.deleteRouteSnapshot(r)}),o.waitDelete=l(t),e()})}shouldDetach(t){let e=!1;return this.isShowTab$.pipe(v(this.destroyRef)).subscribe(r=>{e=r.isShowTab}),t.data.shouldDetach!=="no"&&e}store(t,e){if(t.data.shouldDetach==="no")return;let r=h(t);if(o.waitDelete===r){this.runHook("_onReuseDestroy",e.componentRef),e.componentRef.destroy(),o.waitDelete=null,delete o.scrollHandlers[r];return}let a=[];t.data.needKeepScroll!=="no"&&((t.data.scrollContain??[]).forEach(c=>{let p=this.doc.querySelector(c);if(p){let f=this.scrollService.getScrollPosition(p);a.push({[c]:f})}}),a.push({window:this.scrollService.getScrollPosition()})),o.scrollHandlers[r]={scroll:a},o.handlers[r]=e,e&&e.componentRef&&this.runHook("_onReuseDestroy",e.componentRef)}shouldAttach(t){let e=h(t);return!!e&&!!o.handlers[e]}retrieve(t){let e=h(t);return e?o.handlers[e]:null}shouldReuseRoute(t,e){let r=h(t),a=h(e);r&&o.handlers[r]&&this.runHook("_onReuseInit",o.handlers[r].componentRef);let s=r===a;for(;t.firstChild;)t=t.firstChild;let c=h(t);return c&&o.scrollHandlers[c]&&o.scrollHandlers[c].scroll.forEach(p=>{Object.keys(p).forEach(f=>{setTimeout(()=>{this.scrollService.scrollToPosition(this.doc.querySelector(f),p[f])},1)})}),s}runHook(t,e){if(e==null||!e.instance)return;let r=e.instance,a=r[t];typeof a=="function"&&a.call(r)}};o.handlers={},o.scrollHandlers={};var n=o;var d=class d{constructor(){this.tabArray$=new g([]);this.tabArray=[];this.currSelectedIndexTab=0;this.router=i(T);this.activatedRoute=i(R)}getTabArray$(){return this.tabArray$.asObservable()}setTabArray$(t){this.tabArray$.next(t)}setTabsSourceData(){this.setTabArray$(this.tabArray)}clearTabs(){this.tabArray=[],this.setTabsSourceData()}addTab(t,e=!1){this.tabArray.forEach(r=>{r.title===t.title&&!e&&(r.snapshotArray=P.default.uniqBy([...r.snapshotArray,...t.snapshotArray],a=>a._routerState.url),r.path=t.path)}),this.tabArray.find(r=>r.path===t.path)||this.tabArray.push(t),this.setTabsSourceData()}getTabArray(){return this.tabArray}changeTabTitle(t){this.tabArray[this.getCurrentTabIndex()].title=t,this.setTabArray$(this.tabArray)}delReuseStrategy(t){this.getSnapshotArrayKey(t).forEach(r=>{n.deleteRouteSnapshot(r)})}getSnapshotArrayKey(t){let e=[];return t.forEach(r=>{let a=l(r);e.push(a)}),e}delRightTab(t,e){let r=this.tabArray.filter((a,s)=>s>e);this.tabArray.length=e+1,r.forEach(({snapshotArray:a})=>{this.delReuseStrategy(a)}),e<this.currSelectedIndexTab&&(n.waitDelete=l(this.activatedRoute.snapshot),this.router.navigateByUrl(this.tabArray[e].path)),this.setTabsSourceData()}delLeftTab(t,e){let r=this.tabArray.filter((a,s)=>s<e);this.currSelectedIndexTab===e?this.currSelectedIndexTab=0:this.currSelectedIndexTab<e?(n.waitDelete=l(this.activatedRoute.snapshot),this.currSelectedIndexTab=0):this.currSelectedIndexTab>e&&(this.currSelectedIndexTab=this.currSelectedIndexTab-r.length),this.tabArray=this.tabArray.splice(r.length),r.forEach(({snapshotArray:a})=>{this.delReuseStrategy(a)}),this.setTabsSourceData(),this.router.navigateByUrl(this.tabArray[this.currSelectedIndexTab].path)}delOtherTab(t,e){let r=this.tabArray.filter((a,s)=>s!==e);this.tabArray=[this.tabArray[e]],r.forEach(({snapshotArray:a})=>{this.delReuseStrategy(a)}),e!==this.currSelectedIndexTab&&(n.waitDelete=l(this.activatedRoute.snapshot)),this.router.navigateByUrl(t),this.setTabsSourceData()}delTab(t,e){if(e===this.currSelectedIndexTab){let r=l(this.activatedRoute.snapshot);this.tabArray.splice(e,1),this.currSelectedIndexTab=e-1<0?0:e-1,this.router.navigateByUrl(this.tabArray[this.currSelectedIndexTab].path),n.waitDelete=r}else e<this.currSelectedIndexTab?(this.tabArray.splice(e,1),this.currSelectedIndexTab=this.currSelectedIndexTab-1):e>this.currSelectedIndexTab&&this.tabArray.splice(e,1);this.delReuseStrategy(t.snapshotArray),this.setTabsSourceData()}findIndex(t){let e=this.tabArray.findIndex(r=>t===r.path);return this.currSelectedIndexTab=e,e}getCurrentPathWithoutParam(t,e){let r=[],a=Object.values(e);return t.forEach(s=>{a.includes(s.path)||r.push(s.path)}),`${r.join("/")}`}refresh(){let t=this.activatedRoute.snapshot,e=l(t);for(;t.firstChild;)t=t.firstChild;let r,a="";if(Object.keys(t.params).length>0)r=t.params,a=this.getCurrentPathWithoutParam(t._urlSegment.segments,r),this.router.navigateByUrl("/blank/global-loading",{skipLocationChange:!0}).then(()=>{n.deleteRouteSnapshot(e),this.router.navigate([a,...Object.values(r)])});else{r=t.queryParams;let s=this.router.url,c=I(s);this.router.navigateByUrl("/blank/global-loading",{skipLocationChange:!0}).then(()=>{n.deleteRouteSnapshot(e),this.router.navigate([c],{queryParams:r})})}}getCurrentTabIndex(){return this.currSelectedIndexTab}};d.\u0275fac=function(e){return new(e||d)},d.\u0275prov=b({token:d,factory:d.\u0275fac,providedIn:"root"});var w=d;export{m as a,n as b,w as c};
