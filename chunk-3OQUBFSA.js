import{a as Z}from"./chunk-LZZYUYSO.js";import"./chunk-YZQKBSXU.js";import"./chunk-6DGE2S5E.js";import"./chunk-AZDBKI4P.js";import"./chunk-FL7BS3BX.js";import"./chunk-Q5VVKPDT.js";import"./chunk-IK75FPLE.js";import"./chunk-BH5DKTT6.js";import"./chunk-NTMY3SYH.js";import"./chunk-PRNJDQ6J.js";import"./chunk-ESTIS766.js";import"./chunk-F5ALC7SR.js";import"./chunk-67WDHJZZ.js";import"./chunk-6E3GIBKW.js";import"./chunk-L7ZCTNHS.js";import{d as L}from"./chunk-NGTZY5Y2.js";import{Aa as y,Ba as E,Jc as w,La as G,Lb as T,Qb as O,Va as R,cc as H,dc as A,dd as P,ec as x,jd as g,ra as $,rc as N,sc as j,vb as v}from"./chunk-PHCOYEBV.js";import{a as k,b as D}from"./chunk-VB56BUGO.js";var J=["*"];function X(){return window.devicePixelRatio||1}function K(a){return a.replace(/([A-Z])/g,"-$1").toLowerCase()}function Q(a){return Object.keys(a).map(t=>`${K(t)}: ${a[t]};`).join(" ")}function _(a,i){let h=!1;return a.removedNodes.length&&(h=Array.from(a.removedNodes).some(t=>t===i)),a.type==="attributes"&&a.target===i&&(h=!0),h}function M(a,i,h,t){a.translate(i,h),a.rotate(Math.PI/180*Number(t)),a.translate(-i,-h)}var S=2,Y=3,U=(()=>{let i=class i{constructor(t,e,n){this.el=t,this.document=e,this.cdr=n,this.nzWidth=120,this.nzHeight=64,this.nzRotate=-22,this.nzZIndex=9,this.nzImage="",this.nzContent="",this.nzFont={},this.nzGap=[100,100],this.nzOffset=[this.nzGap[0]/2,this.nzGap[1]/2],this.waterMarkElement=this.document.createElement("div"),this.stopObservation=!1,this.observer=new MutationObserver(r=>{this.stopObservation||r.forEach(o=>{_(o,this.waterMarkElement)&&(this.destroyWatermark(),this.renderWatermark())})})}ngOnInit(){this.observer.observe(this.el.nativeElement,{subtree:!0,childList:!0,attributeFilter:["style","class"]})}ngAfterViewInit(){this.renderWatermark()}ngOnChanges(t){let{nzRotate:e,nzZIndex:n,nzWidth:r,nzHeight:o,nzImage:s,nzContent:l,nzFont:d,gapX:p,gapY:c,offsetLeft:m,offsetTop:u}=t;(e||n||r||o||s||l||d||p||c||m||u)&&this.renderWatermark()}getFont(){let t={color:"rgba(0,0,0,.15)",fontSize:16,fontWeight:"normal",fontFamily:"sans-serif",fontStyle:"normal"};this.nzFont=k(k({},t),this.nzFont),this.cdr.markForCheck()}getMarkStyle(){let t={zIndex:this.nzZIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat",visibility:"visible"},e=(this.nzOffset?.[0]??this.nzGap[0]/2)-this.nzGap[0]/2,n=(this.nzOffset?.[1]??this.nzGap[1]/2)-this.nzGap[1]/2;return e>0&&(t.left=`${e}px`,t.width=`calc(100% - ${e}px)`,e=0),n>0&&(t.top=`${n}px`,t.height=`calc(100% - ${n}px)`,n=0),t.backgroundPosition=`${e}px ${n}px`,t}destroyWatermark(){this.waterMarkElement&&this.waterMarkElement.remove()}appendWatermark(t,e){this.stopObservation=!0,this.waterMarkElement.setAttribute("style",Q(D(k({},this.getMarkStyle()),{backgroundImage:`url('${t}')`,backgroundSize:`${(this.nzGap[0]+e)*S}px`}))),this.el.nativeElement.append(this.waterMarkElement),this.cdr.markForCheck(),setTimeout(()=>{this.stopObservation=!1,this.cdr.markForCheck()})}getMarkSize(t){let e=120,n=64;if(!this.nzImage&&t.measureText){t.font=`${Number(this.nzFont.fontSize)}px ${this.nzFont.fontFamily}`;let r=Array.isArray(this.nzContent)?this.nzContent:[this.nzContent],o=r.map(s=>t.measureText(s).width);e=Math.ceil(Math.max(...o)),n=Number(this.nzFont.fontSize)*r.length+(r.length-1)*Y}return[this.nzWidth??e,this.nzHeight??n]}fillTexts(t,e,n,r,o){let s=X(),l=Number(this.nzFont.fontSize)*s;t.font=`${this.nzFont.fontStyle} normal ${this.nzFont.fontWeight} ${l}px/${o}px ${this.nzFont.fontFamily}`,this.nzFont.color&&(t.fillStyle=this.nzFont.color),t.textAlign="center",t.textBaseline="top",t.translate(r/2,0),(Array.isArray(this.nzContent)?this.nzContent:[this.nzContent])?.forEach((p,c)=>{t.fillText(p??"",e,n+c*(l+Y*s))})}drawText(t,e,n,r,o,s,l,d,p,c,m){this.fillTexts(e,n,r,o,s),e.restore(),M(e,l,d,this.nzRotate),this.fillTexts(e,p,c,o,s),this.appendWatermark(t.toDataURL(),m)}renderWatermark(){if(!this.nzContent&&!this.nzImage)return;let t=this.document.createElement("canvas"),e=t.getContext("2d");if(e){this.waterMarkElement||(this.waterMarkElement=this.document.createElement("div")),this.getFont();let n=X(),[r,o]=this.getMarkSize(e),s=(this.nzGap[0]+r)*n,l=(this.nzGap[1]+o)*n;t.setAttribute("width",`${s*S}px`),t.setAttribute("height",`${l*S}px`);let d=this.nzGap[0]*n/2,p=this.nzGap[1]*n/2,c=r*n,m=o*n,u=(c+this.nzGap[0]*n)/2,W=(m+this.nzGap[1]*n)/2,b=d+s,C=p+l,I=u+s,F=W+l;if(e.save(),M(e,u,W,this.nzRotate),this.nzImage){let f=new Image;f.onload=()=>{e.drawImage(f,d,p,c,m),e.restore(),M(e,I,F,this.nzRotate),e.drawImage(f,b,C,c,m),this.appendWatermark(t.toDataURL(),r)},f.onerror=()=>this.drawText(t,e,d,p,c,m,I,F,b,C,r),f.crossOrigin="anonymous",f.referrerPolicy="no-referrer",f.src=this.nzImage}else this.drawText(t,e,d,p,c,m,I,F,b,C,r)}}ngOnDestroy(){this.observer.disconnect()}};i.\u0275fac=function(e){return new(e||i)(v(R),v(L),v(P))},i.\u0275cmp=y({type:i,selectors:[["nz-water-mark"]],hostAttrs:[1,"ant-water-mark"],inputs:{nzWidth:[2,"nzWidth","nzWidth",g],nzHeight:[2,"nzHeight","nzHeight",g],nzRotate:[2,"nzRotate","nzRotate",g],nzZIndex:[2,"nzZIndex","nzZIndex",g],nzImage:"nzImage",nzContent:"nzContent",nzFont:"nzFont",nzGap:"nzGap",nzOffset:"nzOffset"},exportAs:["NzWaterMark"],standalone:!0,features:[T,G,w],ngContentSelectors:J,decls:1,vars:0,template:function(e,n){e&1&&(N(),j(0))},encapsulation:2,changeDetection:0});let a=i;return a})(),B=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=E({type:i}),i.\u0275inj=$({});let a=i;return a})();var z=class z{constructor(){this.pageHeaderInfo={title:"\u6C34\u5370",breadcrumb:["\u9996\u9875","\u529F\u80FD","\u6C34\u5370"],desc:"\u6CA1\u4EC0\u4E48\uFF0C\u642C\u8FD0\u7684zorro\u5B98\u7F51\u793A\u4F8B,https://ng.ant.design/components/water-mark/zh"}}};z.\u0275fac=function(h){return new(h||z)},z.\u0275cmp=y({type:z,selectors:[["app-water-mark"]],standalone:!0,features:[w],decls:4,vars:1,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],["nzContent","NG Ant Design"],[2,"height","500px"]],template:function(h,t){h&1&&(x(0,"app-page-header",0),H(1,"div",1)(2,"nz-water-mark",2),x(3,"div",3),A()()),h&2&&O("pageHeaderInfo",t.pageHeaderInfo)},dependencies:[B,U,Z],changeDetection:0});var V=z;export{V as WaterMarkComponent};
