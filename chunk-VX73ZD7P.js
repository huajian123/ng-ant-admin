import{a as He,b as Ae,c as Le}from"./chunk-7IR6FQY6.js";import{a as Ve}from"./chunk-HPYP3UGD.js";import"./chunk-YZQKBSXU.js";import"./chunk-6DGE2S5E.js";import{c as je,d as We}from"./chunk-Y7DWSVT7.js";import"./chunk-AZDBKI4P.js";import"./chunk-FL7BS3BX.js";import"./chunk-NFHEPG3N.js";import"./chunk-JS4TD4O2.js";import{A as xe,D as Te,E as Ne,a as ke,i as be}from"./chunk-IK75FPLE.js";import{l as A,m as Ee}from"./chunk-BH5DKTT6.js";import"./chunk-NTMY3SYH.js";import{a as Me,b as Re,c as Fe,d as Ze,e as Oe}from"./chunk-VPF7NIXW.js";import{W as H,X as M,ca as De,da as Pe,ea as J,s as N}from"./chunk-F5ALC7SR.js";import"./chunk-67WDHJZZ.js";import"./chunk-6E3GIBKW.js";import{n as _e}from"./chunk-L7ZCTNHS.js";import{d as Ie}from"./chunk-NGTZY5Y2.js";import{$b as B,Aa as P,Ac as V,Ba as ce,Ca as le,Dc as ye,Eb as de,Ic as Ce,Jc as T,K as b,La as me,Lb as ge,Ma as w,Na as y,O as $,Ob as C,Pb as fe,Qb as E,Rb as O,Sa as Z,Sb as x,V as ne,Va as he,Xa as X,Zb as j,ac as U,bc as G,cc as m,dc as p,dd as q,ec as h,g as _,ha as oe,ia as d,ic as W,id as Se,kc as ue,ob as pe,oc as f,pc as ve,qa as re,qc as u,r as k,ra as se,rc as ze,sc as we,ub as g,va as D,vb as l,wa as ae,wc as Q,xc as Y,yc as K}from"./chunk-PHCOYEBV.js";import{a as z}from"./chunk-VB56BUGO.js";var et=["imgRef"],tt=["imagePreviewWrapper"];function it(i,n){if(i&1){let r=W();m(0,"div",13),f("click",function(t){w(r);let o=u();return y(o.onSwitchLeft(t))}),h(1,"span",14),p(),m(2,"div",15),f("click",function(t){w(r);let o=u();return y(o.onSwitchRight(t))}),h(3,"span",16),p()}if(i&2){let r=u();x("ant-image-preview-switch-left-disabled",r.index<=0),g(2),x("ant-image-preview-switch-right-disabled",r.index>=r.images.length-1)}}function nt(i,n){if(i&1&&(m(0,"li",5),V(1),p()),i&2){let r=u();g(),ye("",r.index+1," / ",r.images.length,"")}}function ot(i,n){if(i&1){let r=W();m(0,"li",17),f("click",function(){let t=w(r).$implicit;return y(t.onClick())}),h(1,"span",18),p()}if(i&2){let r,e=n.$implicit,t=u();x("ant-image-preview-operations-operation-disabled",t.zoomOutDisabled&&e.type==="zoomOut"),g(),E("nzType",e.icon)("nzRotate",(r=e.rotate)!==null&&r!==void 0?r:0)}}function rt(i,n){if(i&1&&h(0,"img",20,1),i&2){let r=u().$implicit,e=u();O("width",r.width)("height",r.height)("transform",e.previewImageTransform),fe("src",e.sanitizerResourceUrl(r.src),pe)("srcset",r.srcset)("alt",r.alt)}}function st(i,n){if(i&1&&C(0,rt,2,9,"img",19),i&2){let r=n.$index,e=u();j(r===e.index?0:-1)}}var at=["*"];var Qe="image";function ct(i){let n={};return i.width<=i.clientWidth&&i.height<=i.clientHeight&&(n={x:0,y:0}),(i.width>i.clientWidth||i.height>i.clientHeight)&&(n={x:Ue(i.left,i.width,i.clientWidth),y:Ue(i.top,i.height,i.clientHeight)}),n}function lt(i){let n=i.getBoundingClientRect(),r=document.documentElement;return{left:n.left+(window.pageXOffset||r.scrollLeft)-(r.clientLeft||document.body.clientLeft||0),top:n.top+(window.pageYOffset||r.scrollTop)-(r.clientTop||document.body.clientTop||0)}}function mt(){let i=document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight;return{width:i,height:n}}function Ue(i,n,r){let e=i+n,t=(n-r)/2,o=null;return n>r?(i>0&&(o=t),i<0&&e<r&&(o=-t)):(i<0||e>r)&&(o=i<0?t:-t),o}var R=class{constructor(){this.nzKeyboard=!0,this.nzNoAnimation=!1,this.nzMaskClosable=!0,this.nzCloseOnNavigation=!0}},Ge={x:0,y:0},ee=.5,ht=1,pt=0,Ye=(()=>{let n=class n{get animationDisabled(){return this.config.nzNoAnimation??!1}get maskClosable(){let e=this.nzConfigService.getConfigForComponent(Qe)||{};return this.config.nzMaskClosable??e.nzMaskClosable??!0}constructor(e,t,o,s,c,a){this.ngZone=e,this.cdr=t,this.nzConfigService=o,this.config=s,this.destroy$=c,this.sanitizer=a,this._defaultNzZoom=ht,this._defaultNzScaleStep=ee,this._defaultNzRotate=pt,this.images=[],this.index=0,this.isDragging=!1,this.visible=!0,this.animationStateChanged=new X,this.scaleStepMap=new Map,this.previewImageTransform="",this.previewImageWrapperTransform="",this.operations=[{icon:"close",onClick:()=>{this.onClose()},type:"close"},{icon:"zoom-in",onClick:()=>{this.onZoomIn()},type:"zoomIn"},{icon:"zoom-out",onClick:()=>{this.onZoomOut()},type:"zoomOut"},{icon:"rotate-right",onClick:()=>{this.onRotateRight()},type:"rotateRight"},{icon:"rotate-left",onClick:()=>{this.onRotateLeft()},type:"rotateLeft"},{icon:"swap",onClick:()=>{this.onHorizontalFlip()},type:"flipHorizontally"},{icon:"swap",onClick:()=>{this.onVerticalFlip()},type:"flipVertically",rotate:90}],this.zoomOutDisabled=!1,this.position=z({},Ge),this.closeClick=new X,this.zoom=this.config.nzZoom??this._defaultNzZoom,this.scaleStep=this.config.nzScaleStep??this._defaultNzScaleStep,this.rotate=this.config.nzRotate??this._defaultNzRotate,this.flipHorizontally=this.config.nzFlipHorizontally??!1,this.flipVertically=this.config.nzFlipVertically??!1,this.updateZoomOutDisabled(),this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform()}ngOnInit(){this.ngZone.runOutsideAngular(()=>{b(this.imagePreviewWrapper.nativeElement,"mousedown").pipe(d(this.destroy$)).subscribe(()=>{this.isDragging=!0}),b(this.imagePreviewWrapper.nativeElement,"wheel").pipe(d(this.destroy$)).subscribe(e=>{this.ngZone.run(()=>this.wheelZoomEventHandler(e))})})}setImages(e,t){t&&(this.scaleStepMap=t),this.images=e,this.markForCheck()}switchTo(e){this.index=e,this.markForCheck()}next(){this.index<this.images.length-1&&(this.reset(),this.index++,this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform(),this.updateZoomOutDisabled(),this.markForCheck())}prev(){this.index>0&&(this.reset(),this.index--,this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform(),this.updateZoomOutDisabled(),this.markForCheck())}markForCheck(){this.cdr.markForCheck()}onClose(){this.visible=!1,this.closeClick.emit()}onZoomIn(){let e=this.scaleStepMap.get(this.images[this.index].src??this.images[this.index].srcset)??this.scaleStep;this.zoom+=e,this.updatePreviewImageTransform(),this.updateZoomOutDisabled()}onZoomOut(){if(this.zoom>1){let e=this.scaleStepMap.get(this.images[this.index].src??this.images[this.index].srcset)??this.scaleStep;this.zoom-=e,this.updatePreviewImageTransform(),this.updateZoomOutDisabled(),this.zoom<=1&&this.reCenterImage()}}onRotateRight(){this.rotate+=90,this.updatePreviewImageTransform()}onRotateLeft(){this.rotate-=90,this.updatePreviewImageTransform()}onSwitchLeft(e){e.preventDefault(),e.stopPropagation(),this.prev()}onSwitchRight(e){e.preventDefault(),e.stopPropagation(),this.next()}onHorizontalFlip(){this.flipHorizontally=!this.flipHorizontally,this.updatePreviewImageTransform()}onVerticalFlip(){this.flipVertically=!this.flipVertically,this.updatePreviewImageTransform()}wheelZoomEventHandler(e){e.preventDefault(),e.stopPropagation(),this.handlerImageTransformationWhileZoomingWithMouse(e,e.deltaY),this.handleImageScaleWhileZoomingWithMouse(e.deltaY),this.updatePreviewImageWrapperTransform(),this.updatePreviewImageTransform(),this.markForCheck()}onAnimationStart(e){this.animationStateChanged.emit(e)}onAnimationDone(e){this.animationStateChanged.emit(e)}onDragEnd(e){this.isDragging=!1;let t=this.imageRef.nativeElement.offsetWidth*this.zoom,o=this.imageRef.nativeElement.offsetHeight*this.zoom,{left:s,top:c}=lt(this.imageRef.nativeElement),{width:a,height:v}=mt(),F=this.rotate%180!==0,I=ct({width:F?o:t,height:F?t:o,left:s,top:c,clientWidth:a,clientHeight:v});N(I.x)||N(I.y)?this.position=z(z({},this.position),I):!N(I.x)&&!N(I.y)&&(this.position={x:e.source.getFreeDragPosition().x,y:e.source.getFreeDragPosition().y})}sanitizerResourceUrl(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}updatePreviewImageTransform(){this.previewImageTransform=`scale3d(${this.zoom*(this.flipHorizontally?-1:1)}, ${this.zoom*(this.flipVertically?-1:1)}, 1) rotate(${this.rotate}deg)`}updatePreviewImageWrapperTransform(){this.previewImageWrapperTransform=`translate3d(${this.position.x}px, ${this.position.y}px, 0)`}updateZoomOutDisabled(){this.zoomOutDisabled=this.zoom<=1}handlerImageTransformationWhileZoomingWithMouse(e,t){let o,s=this.imageRef.nativeElement,a=getComputedStyle(s).transform.match(/matrix.*\((.+)\)/);a?o=+a[1].split(", ")[0]:o=this.zoom;let v=(e.clientX-s.getBoundingClientRect().x)/o,F=(e.clientY-s.getBoundingClientRect().y)/o,S=t<0?this.scaleStep/2:-this.scaleStep/2;this.position.x+=-v*S*2+s.offsetWidth*S,this.position.y+=-F*S*2+s.offsetHeight*S}handleImageScaleWhileZoomingWithMouse(e){this.isZoomedInWithMouseWheel(e)?this.onZoomIn():this.onZoomOut(),this.zoom<=1&&this.reCenterImage()}isZoomedInWithMouseWheel(e){return e<0}reset(){this.zoom=this.config.nzZoom??this._defaultNzZoom,this.scaleStep=this.config.nzScaleStep??this._defaultNzScaleStep,this.rotate=this.config.nzRotate??this._defaultNzRotate,this.flipHorizontally=!1,this.flipVertically=!1,this.reCenterImage()}reCenterImage(){this.position=z({},Ge)}};n.\u0275fac=function(t){return new(t||n)(l(de),l(q),l(H),l(R),l(A),l(_e))},n.\u0275cmp=P({type:n,selectors:[["nz-image-preview"]],viewQuery:function(t,o){if(t&1&&(Q(et,5),Q(tt,7)),t&2){let s;Y(s=K())&&(o.imageRef=s.first),Y(s=K())&&(o.imagePreviewWrapper=s.first)}},hostAttrs:[1,"ant-image-preview-root"],hostVars:6,hostBindings:function(t,o){t&1&&ve("@fadeMotion.start",function(c){return o.onAnimationStart(c)})("@fadeMotion.done",function(c){return o.onAnimationDone(c)}),t&2&&(ue("@.disabled",o.config.nzNoAnimation)("@fadeMotion",o.visible?"enter":"leave"),O("z-index",o.config.nzZIndex),x("ant-image-preview-moving",o.isDragging))},exportAs:["nzImagePreview"],standalone:!0,features:[Ce([A]),T],decls:17,vars:5,consts:[["imagePreviewWrapper",""],["imgRef",""],[1,"ant-image-preview-mask"],[1,"ant-image-preview-operations-wrapper"],[1,"ant-image-preview-operations"],[1,"ant-image-preview-operations-progress"],[1,"ant-image-preview-operations-operation",3,"ant-image-preview-operations-operation-disabled"],["tabindex","-1",1,"ant-image-preview-wrap",3,"click"],["role","dialog","aria-modal","true",1,"ant-image-preview"],["tabindex","0","aria-hidden","true",2,"width","0","height","0","overflow","hidden","outline","none"],[1,"ant-image-preview-content"],[1,"ant-image-preview-body"],["cdkDrag","",1,"ant-image-preview-img-wrapper",3,"cdkDragEnded","cdkDragFreeDragPosition"],[1,"ant-image-preview-switch-left",3,"click"],["nz-icon","","nzType","left","nzTheme","outline"],[1,"ant-image-preview-switch-right",3,"click"],["nz-icon","","nzType","right","nzTheme","outline"],[1,"ant-image-preview-operations-operation",3,"click"],["nz-icon","","nzTheme","outline",1,"ant-image-preview-operations-icon",3,"nzType","nzRotate"],["cdkDragHandle","",1,"ant-image-preview-img",3,"width","height","transform"],["cdkDragHandle","",1,"ant-image-preview-img"]],template:function(t,o){if(t&1){let s=W();h(0,"div",2),m(1,"div",3),C(2,it,4,4),m(3,"ul",4),C(4,nt,2,2,"li",5),U(5,ot,2,4,"li",6,B),p()(),m(7,"div",7),f("click",function(a){return w(s),y(o.maskClosable&&a.target===a.currentTarget&&o.onClose())}),m(8,"div",8),h(9,"div",9),m(10,"div",10)(11,"div",11)(12,"div",12,0),f("cdkDragEnded",function(a){return w(s),y(o.onDragEnd(a))}),U(14,st,1,1,null,null,B),p()()(),h(16,"div",9),p()()}t&2&&(g(2),j(o.images.length>1?2:-1),g(2),j(o.images.length>1?4:-1),g(),G(o.operations),g(7),O("transform",o.previewImageWrapperTransform),E("cdkDragFreeDragPosition",o.position),g(2),G(o.images))},dependencies:[Pe,De,je,We],encapsulation:2,data:{animation:[be]},changeDetection:0});let i=n;return i})(),te=class{constructor(n,r,e){this.previewInstance=n,this.config=r,this.overlayRef=e,this.destroy$=new _,e.keydownEvents().pipe($(t=>this.config.nzKeyboard&&(t.keyCode===27||t.keyCode===37||t.keyCode===39)&&!Ee(t))).subscribe(t=>{t.preventDefault(),t.keyCode===27&&n.onClose(),t.keyCode===37&&this.prev(),t.keyCode===39&&this.next()}),e.detachments().subscribe(()=>{this.overlayRef.dispose()}),n.closeClick.pipe(ne(1),oe(()=>n.animationStateChanged),$(t=>t.phaseName==="done"),d(this.destroy$)).subscribe(()=>{this.close()})}switchTo(n){this.previewInstance.switchTo(n)}next(){this.previewInstance.next()}prev(){this.previewInstance.prev()}close(){this.destroy$.next(),this.overlayRef.dispose()}},L=(()=>{let n=class n{constructor(e,t,o,s){this.overlay=e,this.injector=t,this.nzConfigService=o,this.directionality=s}preview(e,t,o){return this.display(e,t,o)}display(e,t,o){let s=z(z({},new R),t??{}),c=this.createOverlay(s),a=this.attachPreviewComponent(c,s);a.setImages(e,o);let v=new te(a,s,c);return a.previewRef=v,v}attachPreviewComponent(e,t){let o=Z.create({parent:this.injector,providers:[{provide:Te,useValue:e},{provide:R,useValue:t}]}),s=new ke(Ye,null,o);return e.attach(s).instance}createOverlay(e){let t=this.nzConfigService.getConfigForComponent(Qe)||{},o=new xe({scrollStrategy:this.overlay.scrollStrategies.block(),positionStrategy:this.overlay.position().global(),disposeOnNavigation:e.nzCloseOnNavigation??t.nzCloseOnNavigation??!0,direction:e.nzDirection||t.nzDirection||this.directionality.value});return this.overlay.create(o)}};n.\u0275fac=function(t){return new(t||n)(D(Ne),D(Z),D(H),D(J,8))},n.\u0275prov=re({token:n,factory:n.\u0275fac});let i=n;return i})(),ie=(()=>{let n=class n{constructor(){this.nzScaleStep=null,this.images=[]}addImage(e){this.images.push(e)}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=P({type:n,selectors:[["nz-image-group"]],inputs:{nzScaleStep:"nzScaleStep"},exportAs:["nzImageGroup"],standalone:!0,features:[T],ngContentSelectors:at,decls:1,vars:0,template:function(t,o){t&1&&(ze(),we(0))},encapsulation:2,changeDetection:0});let i=n;return i})(),dt="image",Ke=(()=>{let n=class n{get previewable(){return!this.nzDisablePreview&&this.status!=="error"}constructor(e,t,o,s,c,a,v){this.document=e,this.nzConfigService=t,this.elementRef=o,this.nzImageService=s,this.cdr=c,this.parentGroup=a,this.directionality=v,this._nzModuleName=dt,this.nzSrc="",this.nzSrcset="",this.nzDisablePreview=!1,this.nzFallback=null,this.nzPlaceholder=null,this.nzScaleStep=null,this.status="normal",this.backLoadDestroy$=new _,this.destroy$=new _}ngOnInit(){this.backLoad(),this.parentGroup&&this.parentGroup.addImage(this),this.directionality&&(this.directionality.change?.pipe(d(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPreview(){if(this.previewable)if(this.parentGroup){let e=this.parentGroup.images.filter(a=>a.previewable),t=e.map(a=>({src:a.nzSrc,srcset:a.nzSrcset})),o=e.findIndex(a=>this===a),s=new Map;e.forEach(a=>{s.set(a.nzSrc??a.nzSrcset,a.nzScaleStep??this.parentGroup.nzScaleStep??this.nzScaleStep??ee)}),this.nzImageService.preview(t,{nzDirection:this.dir},s).switchTo(o)}else{let e=[{src:this.nzSrc,srcset:this.nzSrcset}];this.nzImageService.preview(e,{nzDirection:this.dir,nzScaleStep:this.nzScaleStep??ee})}}getElement(){return this.elementRef}ngOnChanges(e){let{nzSrc:t}=e;t&&(this.getElement().nativeElement.src=t.currentValue,this.backLoad())}backLoad(){this.backLoadImage=this.document.createElement("img"),this.backLoadImage.src=this.nzSrc,this.backLoadImage.srcset=this.nzSrcset,this.status="loading",this.backLoadDestroy$.next(),this.backLoadDestroy$.complete(),this.backLoadDestroy$=new _,this.backLoadImage.complete?(this.status="normal",this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset):(this.nzPlaceholder?(this.getElement().nativeElement.src=this.nzPlaceholder,this.getElement().nativeElement.srcset=""):(this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset),b(this.backLoadImage,"load").pipe(d(this.backLoadDestroy$),d(this.destroy$)).subscribe(()=>{this.status="normal",this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset}),b(this.backLoadImage,"error").pipe(d(this.backLoadDestroy$),d(this.destroy$)).subscribe(()=>{this.status="error",this.nzFallback&&(this.getElement().nativeElement.src=this.nzFallback,this.getElement().nativeElement.srcset="")}))}};n.\u0275fac=function(t){return new(t||n)(l(Ie),l(H),l(he),l(L),l(q),l(ie,8),l(J,8))},n.\u0275dir=le({type:n,selectors:[["img","nz-image",""]],hostBindings:function(t,o){t&1&&f("click",function(){return o.onPreview()})},inputs:{nzSrc:"nzSrc",nzSrcset:"nzSrcset",nzDisablePreview:[2,"nzDisablePreview","nzDisablePreview",Se],nzFallback:"nzFallback",nzPlaceholder:"nzPlaceholder",nzScaleStep:"nzScaleStep"},exportAs:["nzImage"],standalone:!0,features:[ge,me]});let i=n;return k([M()],i.prototype,"nzDisablePreview",void 0),k([M()],i.prototype,"nzFallback",void 0),k([M()],i.prototype,"nzPlaceholder",void 0),k([M()],i.prototype,"nzScaleStep",void 0),i})(),qe=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ce({type:n}),n.\u0275inj=se({providers:[L],imports:[Ye]});let i=n;return i})();function ft(i,n){i&1&&h(0,"img",5)}function ut(i,n){i&1&&h(0,"img",6)}var si=(()=>{let n=class n{constructor(){this.pageHeaderInfo={title:"\u56FE\u7247\u9884\u89C8",breadcrumb:["\u9996\u9875","\u529F\u80FD","\u56FE\u7247\u9884\u89C8"]},this.nzImageService=ae(L)}onClick(){let e=[{src:"https://img.alicdn.com/tfs/TB1g.mWZAL0gK0jSZFtXXXQCXXa-200-200.svg",width:"200px",height:"200px",alt:"ng-zorro"},{src:"https://img.alicdn.com/tfs/TB1Z0PywTtYBeNjy1XdXXXXyVXa-186-200.svg",width:"200px",height:"200px",alt:"angular"}];this.nzImageService.preview(e,{nzZoom:1.5,nzRotate:0})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=P({type:n,selectors:[["app-img-preview"]],standalone:!0,features:[T],decls:9,vars:1,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],["alt","","nz-image","","nzSrc","https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png","width","200px",4,"nzSpaceItem"],["alt","","nz-image","","nzSrc","https://img.alicdn.com/tfs/TB1Z0PywTtYBeNjy1XdXXXXyVXa-186-200.svg","width","200px",4,"nzSpaceItem"],["nz-button","","nzType","primary",1,"m-t-8",3,"click"],["alt","","nz-image","","nzSrc","https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png","width","200px"],["alt","","nz-image","","nzSrc","https://img.alicdn.com/tfs/TB1Z0PywTtYBeNjy1XdXXXXyVXa-186-200.svg","width","200px"]],template:function(t,o){t&1&&(h(0,"app-page-header",0),m(1,"div",1)(2,"nz-image-group")(3,"nz-space"),C(4,ft,1,0,"img",2)(5,ut,1,0,"img",3),p()(),h(6,"br"),m(7,"button",4),f("click",function(){return o.onClick()}),V(8,"\u65E0\u56FE\u9884\u89C8"),p()()),t&2&&E("pageHeaderInfo",o.pageHeaderInfo)},dependencies:[Ve,qe,Ke,ie,Le,Ae,He,Oe,Ze,Me,Re,Fe],styles:["img[_ngcontent-%COMP%]{max-width:200px}"],changeDetection:0});let i=n;return i})();export{si as ImgPreviewComponent};
