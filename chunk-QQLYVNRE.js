import{b as g,c as w}from"./chunk-EP7SI4KN.js";import{a as T}from"./chunk-JOXECPUC.js";import{a as v}from"./chunk-3D3NKZKE.js";import{b as A}from"./chunk-CFRJ472G.js";import{a as M}from"./chunk-YVK37IW7.js";import{a as U}from"./chunk-TXJPWTOS.js";import{a as f,b as l}from"./chunk-ZMRRVVPG.js";import{a as S}from"./chunk-YN3PI5LS.js";import{i as y,m as I}from"./chunk-6E3GIBKW.js";import{Ua as h,Z as d,i as b,qa as s,wa as r}from"./chunk-PHCOYEBV.js";var o=class o{constructor(){this.http=r(T)}login(e){return this.http.post("/login",e,{needSuccessInfo:!1})}getMenuByUserId(e){return this.http.get(`/sysPermission/menu/${e}`)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"});var m=o;var i=class i{constructor(){this.menuArray$=new b([])}setMenuArrayStore(e){this.menuArray$.next(e)}getMenuArrayStore(){return this.menuArray$.asObservable()}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=s({token:i,factory:i.\u0275fac,providedIn:"root"});var p=i;var n=class n{constructor(){this.destroyRef=r(h);this.activatedRoute=r(y);this.tabService=r(w);this.loginService=r(m);this.router=r(I);this.userInfoService=r(U);this.menuService=r(p);this.windowServe=r(M)}getMenuByUserId(e){return this.loginService.getMenuByUserId(e)}loginIn(e){return new Promise(t=>{this.windowServe.setSessionStorage(l,f+e);let a=this.userInfoService.parsToken(f+e);a.authCode.push(v.TabsDetail),a.authCode.push(v.SearchTableDetail),this.userInfoService.setUserInfo(a),this.getMenuByUserId(a.userId).pipe(d(()=>{t()}),S(this.destroyRef)).subscribe(c=>{c=c.filter(u=>(u.selected=!1,u.open=!1,u.menuType==="C"));let R=A(c);this.menuService.setMenuArrayStore(R),t()})})}clearTabCash(){return g.deleteAllRouteSnapshot(this.activatedRoute.snapshot).then(()=>new Promise(e=>{this.tabService.clearTabs(),e()}))}clearSessionCash(){return new Promise(e=>{this.windowServe.removeSessionStorage(l),this.menuService.setMenuArrayStore([]),e()})}loginOut(){return this.clearTabCash().then(()=>this.clearSessionCash()).then(()=>{this.router.navigate(["/login/login-form"])})}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=s({token:n,factory:n.\u0275fac,providedIn:"root"});var j=n;export{m as a,p as b,j as c};
