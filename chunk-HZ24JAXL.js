import{a as pe,d as le}from"./chunk-SD6I7EBR.js";import{a as me}from"./chunk-UYI573E5.js";import"./chunk-O2WPPUR2.js";import"./chunk-CLJGZU7Y.js";import{a as q}from"./chunk-2KO7AHLC.js";import{a as se,b as ce}from"./chunk-FMV2SP2L.js";import"./chunk-FZHGVVNJ.js";import{f as ae,g as ue}from"./chunk-YGFGTHXD.js";import"./chunk-HDT4KMAI.js";import"./chunk-IRQU3GS3.js";import"./chunk-VNID2NCF.js";import"./chunk-KZXNDGZT.js";import{a as ie,d as ne,e as re}from"./chunk-CUBBA5TV.js";import{d as L,g as U,k as V,w as K}from"./chunk-WL72DHP4.js";import"./chunk-63CUI4A7.js";import"./chunk-BE5UFXKQ.js";import"./chunk-AOHLMCKO.js";import{a as ee,b as te,c as oe}from"./chunk-JG7PDFQU.js";import"./chunk-LMT2TBSV.js";import"./chunk-7PKCM743.js";import"./chunk-MCCZJH2J.js";import{a as Q,b as X,c as Y,d as Z,e as $}from"./chunk-S2KEA7XP.js";import"./chunk-NYWSPOYR.js";import"./chunk-ZGT77FDO.js";import{a as P}from"./chunk-XMISJKZ6.js";import"./chunk-TLY6E2EZ.js";import"./chunk-I3AI2SV7.js";import"./chunk-ZWOUEGUH.js";import{$b as W,Aa as E,Ac as h,Bc as j,Cc as I,Fc as R,Gc as O,Hc as H,Jc as G,Kc as D,Qb as _,Ua as T,a as x,ac as M,b as N,bc as A,cc as l,d as k,dc as m,dd as J,ec as B,g as S,h as F,j as b,oc as w,ub as f,wa as z}from"./chunk-XNENNAZS.js";import"./chunk-VB56BUGO.js";var de={url:"",deserializer:s=>JSON.parse(s.data),serializer:s=>JSON.stringify(s)},fe="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",y=class s extends F{constructor(e,n){if(super(),this._socket=null,e instanceof k)this.destination=n,this.source=e;else{let i=this._config=Object.assign({},de);if(this._output=new S,typeof e=="string")i.url=e;else for(let r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);if(!i.WebSocketCtor&&WebSocket)i.WebSocketCtor=WebSocket;else if(!i.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new b}}lift(e){let n=new s(this._config,this.destination);return n.operator=e,n.source=this,n}_resetState(){this._socket=null,this.source||(this.destination=new b),this._output=new S}multiplex(e,n,i){let r=this;return new k(t=>{try{r.next(e())}catch(c){t.error(c)}let o=r.subscribe({next:c=>{try{i(c)&&t.next(c)}catch(a){t.error(a)}},error:c=>t.error(c),complete:()=>t.complete()});return()=>{try{r.next(n())}catch(c){t.error(c)}o.unsubscribe()}})}_connectSocket(){let{WebSocketCtor:e,protocol:n,url:i,binaryType:r}=this._config,t=this._output,o=null;try{o=n?new e(i,n):new e(i),this._socket=o,r&&(this._socket.binaryType=r)}catch(a){t.error(a);return}let c=new x(()=>{this._socket=null,o&&o.readyState===1&&o.close()});o.onopen=a=>{let{_socket:p}=this;if(!p){o.close(),this._resetState();return}let{openObserver:v}=this._config;v&&v.next(a);let g=this.destination;this.destination=N.create(u=>{if(o.readyState===1)try{let{serializer:d}=this._config;o.send(d(u))}catch(d){this.destination.error(d)}},u=>{let{closingObserver:d}=this._config;d&&d.next(void 0),u&&u.code?o.close(u.code,u.reason):t.error(new TypeError(fe)),this._resetState()},()=>{let{closingObserver:u}=this._config;u&&u.next(void 0),o.close(),this._resetState()}),g&&g instanceof b&&c.add(g.subscribe(this.destination))},o.onerror=a=>{this._resetState(),t.error(a)},o.onclose=a=>{o===this._socket&&this._resetState();let{closeObserver:p}=this._config;p&&p.next(a),a.wasClean?t.complete():t.error(a)},o.onmessage=a=>{try{let{deserializer:p}=this._config;t.next(p(a))}catch(p){t.error(p)}}}_subscribe(e){let{source:n}=this;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(()=>{let{_socket:i}=this;this._output.observers.length===0&&(i&&(i.readyState===1||i.readyState===0)&&i.close(),this._resetState())}),e)}unsubscribe(){let{_socket:e}=this;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),super.unsubscribe()}};function C(s){return new y(s)}var he=()=>[16,16],be=()=>({minRows:3,maxRows:5});function _e(s,e){if(s&1&&(l(0,"div",9)(1,"span",10),h(2),m()(),l(3,"div",11),h(4,"\u5DF2\u8BFB"),m()),s&2){let n=e.$implicit;f(2),j(n)}}var $e=(()=>{let e=class e{constructor(){this.concate=!0,this.destroyRef=z(T),this.pageHeaderInfo={title:"websocket",breadcrumb:["\u9996\u9875","\u529F\u80FD","websocket"]},this.subject=C(`ws://${q}:8003/webSocket`),this.result=[],this.msg="",this.cdr=z(J)}send(){this.subject.next(this.msg),this.msg=""}end(){this.subject.complete(),this.concate=!1}ngAfterViewInit(){this.subject.pipe(P(this.destroyRef)).subscribe(i=>{this.result.push(i.message),this.result=[...this.result],this.cdr.markForCheck()})}ngOnDestroy(){this.subject.complete()}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=E({type:e,selectors:[["app-websocket"]],standalone:!0,features:[G],decls:15,vars:7,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],["nz-row","",3,"nzGutter"],["nz-col","","nzFlex","300px"],["nz-input","","placeholder","\u53D1\u9001\u7684\u5185\u5BB9\u670D\u52A1\u7AEF\u4F1A\u8FD4\u56DE",1,"m-b-8",3,"ngModelChange","nzAutosize","ngModel"],["nz-button","","nzType","primary",3,"click"],["nz-button","","nzType","default",1,"m-l-8",3,"click"],["nz-col","","nzFlex","auto"],["nzTitle","\u6D88\u606F\u5185\u5BB9"],["nz-result-content","",1,"m-t-0","p-8","text-break","m-b-8"],["nz-typography",""],["nz-typography","","nzType","secondary",1,"sp-12","text-right","m-t-5"]],template:function(r,t){r&1&&(B(0,"app-page-header",0),l(1,"div",1)(2,"div",2)(3,"div",3)(4,"textarea",4),H("ngModelChange",function(c){return O(t.msg,c)||(t.msg=c),c}),m(),l(5,"button",5),w("click",function(){return t.send()}),h(6,"\u53D1\u9001"),m(),l(7,"button",6),w("click",function(){return t.end()}),h(8,"\u65AD\u5F00\u8FDE\u63A5"),m(),l(9,"span"),h(10),m()(),l(11,"div",7)(12,"nz-card",8),M(13,_e,5,1,null,null,W),m()()()()),r&2&&(_("pageHeaderInfo",t.pageHeaderInfo),f(2),_("nzGutter",D(5,he)),f(2),_("nzAutosize",D(6,be)),R("ngModel",t.msg),f(6),I("\u94FE\u63A5\u72B6\u6001\uFF1A",t.concate,""),f(3),A(t.result))},dependencies:[me,oe,te,ee,re,ie,ne,K,L,U,V,$,Z,Q,X,Y,ue,ae,le,pe,ce,se],encapsulation:2,changeDetection:0});let s=e;return s})();export{$e as WebsocketComponent};
