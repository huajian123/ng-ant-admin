import{c as ee}from"./chunk-PK5Y6STH.js";import{b as Y}from"./chunk-Y7DWSVT7.js";import{a as ie}from"./chunk-V6VP5ZUC.js";import{c as W,g as K}from"./chunk-5BCZZY3T.js";import{ca as J,da as X}from"./chunk-F5ALC7SR.js";import{a as p}from"./chunk-YN3PI5LS.js";import{x as U}from"./chunk-NGTZY5Y2.js";import{Aa as D,Bb as w,Ha as k,Ic as $,Jc as G,Ma as M,Na as v,Ob as E,Pc as H,Qb as A,Qc as V,Sa as O,Ua as N,Uc as P,_ as z,_c as q,cc as C,dc as g,ec as T,i as I,ic as L,ka as b,nd as Q,oc as y,qa as f,qc as S,ta as R,ub as _,wa as l,wc as j,xc as Z,yc as B,z as F}from"./chunk-PHCOYEBV.js";import{g as re}from"./chunk-VB56BUGO.js";var r=class r{constructor(){this.modalFullStatusStore$=new I(!1)}setModalFullStatusStore(t){this.modalFullStatusStore$.next(t)}getModalFullStatusStore(){return this.modalFullStatusStore$.asObservable()}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=f({token:r,factory:r.\u0275fac,providedIn:"root"});var m=r;var se=["componentTpl"];function ce(c,t){if(c&1){let e=L();C(0,"span",1),y("click",function(n){M(e);let a=S();return v(a.fullScreenIconClick(n))}),T(1,"i",2),H(2,"async"),g(),C(3,"span",3),y("click",function(){M(e);let n=S();return v(n.closeModal())}),T(4,"i",4),g()}if(c&2){let e=S();_(),A("nzType",V(2,1,e.modalFullStatus$)?"fullscreen-exit":"fullscreen")}}var x=class{constructor(){this.modalFullScreenFlag=!1}},i=class i{constructor(){this.modalFullScreenFlag=!1;this.modalFullStatus=l(m);this.modalFullStatus$=this.modalFullStatus.getModalFullStatusStore();this.modalFullStatus$.pipe(p()).subscribe(t=>this.modalFullScreenFlag=t)}fullScreenIconClick(t){this.modalFullScreenFlag=!this.modalFullScreenFlag,this.modalFullStatus.setModalFullStatusStore(this.modalFullScreenFlag),W(t)}closeModal(){this.modalFullScreenFlag=!1,this.modalFullStatus.setModalFullStatusStore(!1)}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=D({type:i,selectors:[["app-global-modal-btn-tpl"]],viewQuery:function(e,o){if(e&1&&j(se,7),e&2){let n;Z(n=B())&&(o.componentTpl=n.first)}},standalone:!0,features:[$([{provide:x,useExisting:i}]),G],decls:2,vars:0,consts:[["componentTpl",""],[1,"hover-blue","full-height","flex-auto","text-right","d-i-b",3,"click"],["nz-icon","","nzTheme","outline",1,"m-r-8",3,"nzType"],[1,"hover-red","full-height","flex-auto","d-i-b",2,"margin-right","14px",3,"click"],["nz-icon","","nzTheme","outline","nzType","close"]],template:function(e,o){e&1&&E(0,ce,5,3,"ng-template",null,0,P)},dependencies:[X,J,U],encapsulation:2,changeDetection:0});var h=i;var ne=new R("modal action btn token",{providedIn:"root",factory:()=>{let c=l(q),t=l(k),e=Q(h,{environmentInjector:t});return c.attachView(e.hostView),e}});var ae=re(ie());var oe=class{constructor(t){this.modalRef=t}},s=class s{constructor(){this.destroyRef=l(N);this.baseInjector=l(O);this.modalFullStatusStoreService=l(m);this.dragDrop=l(Y);this.rendererFactory=l(w);this.btnComponentRef=l(ne);this.bsModalService=this.baseInjector.get(ee),this.renderer=this.rendererFactory.createRenderer(null,null),this.btnTpl=this.btnComponentRef.instance.componentTpl,this.modalFullStatusStoreService.getModalFullStatusStore().pipe(p()).subscribe(t=>{this.fullScreenIconClick(t)})}fullScreenIconClick(t){this.bsModalService.openModals.forEach(e=>{t?this.renderer.addClass(e.containerInstance.host.nativeElement,"fullscreen-modal"):this.renderer.removeClass(e.containerInstance.host.nativeElement,"fullscreen-modal")})}getRandomCls(){return`NZ-MODAL-WRAP-CLS-${K()}`}cancelCallback(t){return this.modalFullStatusStoreService.setModalFullStatusStore(!1),t.modalRef.destroy({status:0,value:null})}confirmCallback(t){t.modalRef.componentInstance.getCurrentValue().pipe(b(e=>(this.modalFullStatusStoreService.setModalFullStatusStore(!1),e?t.modalRef.destroy({status:1,modalValue:e}):F(!1))),p(this.destroyRef)).subscribe()}getZIndex(t){return+getComputedStyle(t,null).zIndex}getModalMaxZIndex(t){return this.bsModalService.openModals.reduce((e,o)=>{let n=o.containerInstance.host.nativeElement;if(t===n)return e;let a=this.getZIndex(n);return a>=e.zIndex&&(e.zIndex=a,e.canChange=!0),e},{zIndex:this.getZIndex(t),canChange:!1})}setMaxZIndex(t){t.addEventListener("mousedown",()=>{let e=this.getModalMaxZIndex(t);e.canChange&&(t.style.zIndex=`${e.zIndex+1}`)},!1)}createDrag(t){let e=document.querySelector(`.${t}`),o=e.querySelector(".ant-modal-content"),n=o.querySelector(".ant-modal-header"),a=this.getModalMaxZIndex(e);return a.canChange&&(e.style.zIndex=`${a.zIndex+1}`),this.setMaxZIndex(e),n?(n.className+=" hand-model-move",this.dragDrop.createDrag(n).withHandles([n]).withRootElement(o)):this.dragDrop.createDrag(o).withHandles([o])}fixedWrapElementStyle(t){t.style.pointerEvents="none"}createModalConfig(t,e={},o,n){let a={nzTitle:"",nzContent:t,nzCloseIcon:e.nzCloseIcon||this.btnTpl,nzMaskClosable:!1,nzFooter:[{label:"\u786E\u8BA4",type:"primary",show:!0,onClick:this.confirmCallback.bind(this)},{label:"\u53D6\u6D88",type:"default",show:!0,onClick:this.cancelCallback.bind(this)}],nzOnCancel:()=>new Promise(u=>{u({status:0,value:null})}),nzClosable:!0,nzWidth:720,nzData:o},d=ae.default.merge(a,e);return d.nzWrapClassName=`${d.nzWrapClassName||""} ${n}`,d}show(t,e={},o){let n=this.getRandomCls(),a=this.createModalConfig(t,e,o,n),d=this.bsModalService.create(a),u;return d.afterOpen.pipe(z(),p(this.destroyRef)).subscribe(()=>{u=this.createDrag(n)}),d.afterClose.pipe(b(()=>{u.dispose(),u=null,this.modalFullStatusStoreService.setModalFullStatusStore(!1)}))}};s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"});var le=s;export{oe as a,le as b};
