import{a as Z}from"./chunk-BYLUI2QE.js";import"./chunk-O2WPPUR2.js";import"./chunk-CLJGZU7Y.js";import"./chunk-HDT4KMAI.js";import"./chunk-IRQU3GS3.js";import"./chunk-T5C3MTIU.js";import"./chunk-LMT2TBSV.js";import"./chunk-7PKCM743.js";import"./chunk-MCCZJH2J.js";import"./chunk-S2KEA7XP.js";import"./chunk-NYWSPOYR.js";import"./chunk-ZGT77FDO.js";import"./chunk-TLY6E2EZ.js";import"./chunk-I3AI2SV7.js";import{d as L}from"./chunk-ZWOUEGUH.js";import{Aa as k,Ba as D,Jc as y,La as E,Lb as R,Qb as O,Va as G,cc as T,dc as A,dd as j,ec as C,id as z,ra as $,rc as H,sc as N,vb as v}from"./chunk-XNENNAZS.js";import{a as u,b as W}from"./chunk-VB56BUGO.js";var V=["*"];function P(){return window.devicePixelRatio||1}function q(r){return r.replace(/([A-Z])/g,"-$1").toLowerCase()}function J(r){return Object.keys(r).map(t=>`${q(t)}: ${r[t]};`).join(" ")}function K(r,n){let m=!1;return r.removedNodes.length&&(m=Array.from(r.removedNodes).some(t=>t===n)),r.type==="attributes"&&r.target===n&&(m=!0),m}function x(r,n,m,t){r.translate(n,m),r.rotate(Math.PI/180*Number(t)),r.translate(-n,-m)}var M=2,X=3,Y=(()=>{let n=class n{constructor(t,e,i){this.el=t,this.document=e,this.cdr=i,this.nzWidth=120,this.nzHeight=64,this.nzRotate=-22,this.nzZIndex=9,this.nzImage="",this.nzContent="",this.nzFont={},this.nzGap=[100,100],this.nzOffset=[this.nzGap[0]/2,this.nzGap[1]/2],this.waterMarkElement=this.document.createElement("div"),this.stopObservation=!1,this.observer=new MutationObserver(a=>{this.stopObservation||a.forEach(o=>{K(o,this.waterMarkElement)&&(this.destroyWatermark(),this.renderWatermark())})})}ngOnInit(){this.observer.observe(this.el.nativeElement,{subtree:!0,childList:!0,attributeFilter:["style","class"]})}ngAfterViewInit(){this.renderWatermark()}ngOnChanges(t){let{nzRotate:e,nzZIndex:i,nzWidth:a,nzHeight:o,nzImage:s,nzContent:c,nzFont:d,gapX:l,gapY:h,offsetLeft:p,offsetTop:g}=t;(e||i||a||o||s||c||d||l||h||p||g)&&this.renderWatermark()}getFont(){let t={color:"rgba(0,0,0,.15)",fontSize:16,fontWeight:"normal",fontFamily:"sans-serif",fontStyle:"normal"};this.nzFont=u(u({},t),this.nzFont),this.cdr.markForCheck()}getMarkStyle(){let t={zIndex:this.nzZIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat",visibility:"visible"},e=(this.nzOffset?.[0]??this.nzGap[0]/2)-this.nzGap[0]/2,i=(this.nzOffset?.[1]??this.nzGap[1]/2)-this.nzGap[1]/2;return e>0&&(t.left=`${e}px`,t.width=`calc(100% - ${e}px)`,e=0),i>0&&(t.top=`${i}px`,t.height=`calc(100% - ${i}px)`,i=0),t.backgroundPosition=`${e}px ${i}px`,t}destroyWatermark(){this.waterMarkElement&&this.waterMarkElement.remove()}appendWatermark(t,e){this.stopObservation=!0,this.waterMarkElement.setAttribute("style",J(W(u({},this.getMarkStyle()),{backgroundImage:`url('${t}')`,backgroundSize:`${(this.nzGap[0]+e)*M}px`}))),this.el.nativeElement.append(this.waterMarkElement),this.cdr.markForCheck(),setTimeout(()=>{this.stopObservation=!1,this.cdr.markForCheck()})}getMarkSize(t){let e=120,i=64;if(!this.nzImage&&t.measureText){t.font=`${Number(this.nzFont.fontSize)}px ${this.nzFont.fontFamily}`;let a=Array.isArray(this.nzContent)?this.nzContent:[this.nzContent],o=a.map(s=>t.measureText(s).width);e=Math.ceil(Math.max(...o)),i=Number(this.nzFont.fontSize)*a.length+(a.length-1)*X}return[this.nzWidth??e,this.nzHeight??i]}fillTexts(t,e,i,a,o){let s=P(),c=Number(this.nzFont.fontSize)*s;t.font=`${this.nzFont.fontStyle} normal ${this.nzFont.fontWeight} ${c}px/${o}px ${this.nzFont.fontFamily}`,this.nzFont.color&&(t.fillStyle=this.nzFont.color),t.textAlign="center",t.textBaseline="top",t.translate(a/2,0),(Array.isArray(this.nzContent)?this.nzContent:[this.nzContent])?.forEach((l,h)=>{t.fillText(l??"",e,i+h*(c+X*s))})}drawText(t,e,i,a,o,s,c,d,l,h,p){this.fillTexts(e,i,a,o,s),e.restore(),x(e,c,d,this.nzRotate),this.fillTexts(e,l,h,o,s),this.appendWatermark(t.toDataURL(),p)}renderWatermark(){if(!this.nzContent&&!this.nzImage)return;let t=this.document.createElement("canvas"),e=t.getContext("2d");if(e){this.waterMarkElement||(this.waterMarkElement=this.document.createElement("div")),this.getFont();let i=P(),[a,o]=this.getMarkSize(e),s=(this.nzGap[0]+a)*i,c=(this.nzGap[1]+o)*i;t.setAttribute("width",`${s*M}px`),t.setAttribute("height",`${c*M}px`);let d=this.nzGap[0]*i/2,l=this.nzGap[1]*i/2,h=a*i,p=o*i,g=(h+this.nzGap[0]*i)/2,S=(p+this.nzGap[1]*i)/2,w=d+s,b=l+c,F=g+s,I=S+c;if(e.save(),x(e,g,S,this.nzRotate),this.nzImage){let f=new Image;f.onload=()=>{e.drawImage(f,d,l,h,p),e.restore(),x(e,F,I,this.nzRotate),e.drawImage(f,w,b,h,p),this.appendWatermark(t.toDataURL(),a)},f.onerror=()=>this.drawText(t,e,d,l,h,p,F,I,w,b,a),f.crossOrigin="anonymous",f.referrerPolicy="no-referrer",f.src=this.nzImage}else this.drawText(t,e,d,l,h,p,F,I,w,b,a)}}ngOnDestroy(){this.observer.disconnect()}};n.\u0275fac=function(e){return new(e||n)(v(G),v(L),v(j))},n.\u0275cmp=k({type:n,selectors:[["nz-water-mark"]],hostAttrs:[1,"ant-water-mark"],inputs:{nzWidth:[2,"nzWidth","nzWidth",z],nzHeight:[2,"nzHeight","nzHeight",z],nzRotate:[2,"nzRotate","nzRotate",z],nzZIndex:[2,"nzZIndex","nzZIndex",z],nzImage:"nzImage",nzContent:"nzContent",nzFont:"nzFont",nzGap:"nzGap",nzOffset:"nzOffset"},exportAs:["NzWaterMark"],standalone:!0,features:[R,E,y],ngContentSelectors:V,decls:1,vars:0,template:function(e,i){e&1&&(H(),N(0))},encapsulation:2,changeDetection:0});let r=n;return r})(),U=(()=>{let n=class n{};n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=D({type:n}),n.\u0275inj=$({});let r=n;return r})();var ct=(()=>{let n=class n{constructor(){this.pageHeaderInfo={title:"\u6C34\u5370",breadcrumb:["\u9996\u9875","\u529F\u80FD","\u6C34\u5370"],desc:"\u6CA1\u4EC0\u4E48\uFF0C\u642C\u8FD0\u7684zorro\u5B98\u7F51\u793A\u4F8B,https://ng.ant.design/components/water-mark/zh"}}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=k({type:n,selectors:[["app-water-mark"]],standalone:!0,features:[y],decls:4,vars:1,consts:[[3,"pageHeaderInfo"],[1,"normal-table-wrap"],["nzContent","NG Ant Design"],[2,"height","500px"]],template:function(e,i){e&1&&(C(0,"app-page-header",0),T(1,"div",1)(2,"nz-water-mark",2),C(3,"div",3),A()()),e&2&&O("pageHeaderInfo",i.pageHeaderInfo)},dependencies:[U,Y,Z],changeDetection:0});let r=n;return r})();export{ct as WaterMarkComponent};
